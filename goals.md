# 📋 ระบบ Goals (บันทึกการยิงประตู)

## 🗂️ ไฟล์ที่เกี่ยวข้อง

```
├── routes/web.php                     → บอกว่า URL ไหน ไปหน้าไหน
├── app/Http/Controllers/GoalsController.php  → สมองของระบบ ประมวลผลทุกอย่าง
└── resources/views/goals/
    ├── index.blade.php   → หน้าดูรายการทั้งหมด
    ├── create.blade.php  → หน้ากรอกข้อมูลใหม่
    └── edit.blade.php    → หน้าแก้ไขข้อมูล
```

---

## 🔗 ไฟล์เชื่อมต่อกันยังไง? (Connection Map)

### 🗺️ แผนที่ง่ายๆ (เข้าใจได้ใน 1 นาที!)

```
╔════════════════════════════════════════════════════════════════════════╗
║                        🚗 เส้นทางการเดินทางของข้อมูล                    ║
╠════════════════════════════════════════════════════════════════════════╣
║                                                                        ║
║   👤 คนเปิดเว็บ     →    📍 Routes     →    🎮 Controller    →   📄 View  ║
║   พิมพ์ URL             บอกทาง             ทำงาน               แสดงผล   ║
║                                               ↕                        ║
║                                          🗄️ Database                   ║
║                                            เก็บข้อมูล                   ║
╚════════════════════════════════════════════════════════════════════════╝
```

### 📌 ตารางการเชื่อมต่อ (ใครคุยกับใคร?)

| ไฟล์ต้นทาง         | เชื่อมไปที่               | ทำอะไร?                                     |
| ------------------ | ------------------------- | ------------------------------------------- |
| `web.php`          | `GoalsController`         | บอกว่า URL `/goals` ให้ไปที่ Controller นี้ |
| `GoalsController`  | ตาราง `Goals` ใน Database | ดึงข้อมูล/เพิ่ม/แก้/ลบ                      |
| `GoalsController`  | `index.blade.php`         | ส่งข้อมูลไปแสดงที่หน้ารายการ                |
| `GoalsController`  | `create.blade.php`        | เปิดหน้าฟอร์มเพิ่มข้อมูล                    |
| `GoalsController`  | `edit.blade.php`          | เปิดหน้าฟอร์มแก้ไขข้อมูล                    |
| `index.blade.php`  | `layout.blade.php`        | ใช้กรอบหน้าเดียวกัน (เมนู, ส่วนหัว)         |
| `create.blade.php` | `layout.blade.php`        | ใช้กรอบหน้าเดียวกัน                         |
| `edit.blade.php`   | `layout.blade.php`        | ใช้กรอบหน้าเดียวกัน                         |

---

### 🎨 ตารางที่เกี่ยวข้อง (ดึงข้อมูลจากไหน?)

**หน้า Goals ใช้ข้อมูลจาก 3 ตาราง:**

| ตาราง     | ใช้ทำอะไร?                                 | Method ที่ใช้        |
| --------- | ------------------------------------------ | -------------------- |
| `Goals`   | เก็บข้อมูลการยิงประตู (รหัส, เวลา, ลูกโทษ) | ทุก Method           |
| `Matches` | ดึงมาให้เลือกว่ายิงในแมทช์ไหน              | `create()`, `edit()` |
| `Players` | ดึงมาให้เลือกว่าใครยิง                     | `create()`, `edit()` |

---

### 🔀 Flow ของแต่ละปุ่ม (กดปุ่มแล้วเกิดอะไร?)

#### 1️⃣ ปุ่ม "เพิ่มข้อมูล" (ในหน้า Index)

```
กดปุ่ม → URL: /goals/create → Controller: create() → View: create.blade.php
```

**อธิบาย:** กดปุ่มสีเขียว "เพิ่มข้อมูล" → ไปหน้ากรอกฟอร์ม

#### 2️⃣ ปุ่ม "บันทึก" (ในหน้า Create)

```
กดปุ่ม → POST /goals → Controller: store() → Database INSERT → กลับหน้า Index
```

**อธิบาย:** กดปุ่มบันทึก → Controller เอาข้อมูลไปเก็บในฐานข้อมูล → กลับหน้าแรก

#### 3️⃣ ปุ่ม "แก้ไข" (ในหน้า Index)

```
กดปุ่ม → URL: /goals/5/edit → Controller: edit(5) → View: edit.blade.php
```

**อธิบาย:** กดปุ่มสีเหลือง "แก้ไข" → ไปหน้าแก้ข้อมูล (พร้อมข้อมูลเดิม)

#### 4️⃣ ปุ่ม "บันทึก" (ในหน้า Edit)

```
กดปุ่ม → PUT /goals/5 → Controller: update(5) → Database UPDATE → กลับหน้า Index
```

**อธิบาย:** กดปุ่มบันทึก → Controller แก้ข้อมูลในฐานข้อมูล → กลับหน้าแรก

#### 5️⃣ ปุ่ม "ลบ" (ในหน้า Index)

```
กดปุ่ม → DELETE /goals/5 → Controller: destroy(5) → Database DELETE → กลับหน้า Index
```

**อธิบาย:** กดปุ่มสีแดง "ลบ" → Controller ลบข้อมูลออกจากฐานข้อมูล → กลับหน้าแรก

---

### 🏠 สรุปแบบเด็กๆ เข้าใจ

**คิดง่ายๆ เหมือนร้านอาหาร:**

-   **Routes (web.php)** = พนักงานต้อนรับ บอกว่าโต๊ะไหนนั่งตรงไหน
-   **Controller** = พ่อครัว รับออเดอร์แล้วทำอาหาร
-   **Database** = ตู้เย็น เก็บวัตถุดิบทั้งหมด
-   **View** = จานอาหาร ที่ลูกค้าเห็นและกินได้

```
ลูกค้าสั่ง (URL) → พนักงานรับ (Routes) → พ่อครัวทำ (Controller)
                                              ↕
                                        ตู้เย็น (Database)
                                              ↓
                                   เสิร์ฟอาหาร (View)
```

---

## 📍 1. Routes (web.php) - บอกทางให้เว็บ

```php
<?php
use App\Http\Controllers\GoalsController;

// บรรทัดนี้บรรทัดเดียว สร้าง 7 เส้นทางให้เราเลย!
// เหมือนบอกว่า "ถ้าคนเข้า /goals ให้ GoalsController จัดการ"
Route::resource('goals', GoalsController::class);

// 7 เส้นทางที่ได้คือ:
// /goals              → ดูรายการทั้งหมด (index)
// /goals/create       → หน้ากรอกข้อมูลใหม่ (create)
// /goals              → บันทึกข้อมูลใหม่ (store) ← ส่งจากฟอร์ม
// /goals/5/edit       → หน้าแก้ไขข้อมูล ID 5 (edit)
// /goals/5            → บันทึกการแก้ไข ID 5 (update) ← ส่งจากฟอร์ม
// /goals/5            → ลบข้อมูล ID 5 (destroy) ← กดปุ่มลบ
```

---

## 🎮 2. Controller (GoalsController.php) - สมองของระบบ

```php
<?php
// ============================================================================
// บรรทัดนี้: บอกว่าไฟล์นี้เป็นภาษา PHP
// ทุกไฟล์ PHP ต้องเริ่มต้นด้วย <?php เสมอ
// ============================================================================

namespace App\Http\Controllers;
// ============================================================================
// บรรทัดนี้: บอก "ที่อยู่" ของไฟล์นี้
// เหมือนบอกว่า "บ้านหลังนี้อยู่ที่ หมู่บ้าน App > ซอย Http > บ้านเลขที่ Controllers"
// ทำให้ Laravel หาไฟล์นี้เจอ
// ============================================================================

use Illuminate\Http\Request;
// ============================================================================
// บรรทัดนี้: ขอยืม "กล่องรับพัสดุ" มาใช้
// Request คือกล่องที่เก็บข้อมูลที่คนกรอกในฟอร์ม
// เช่น ถ้าคนกรอก goal_id = 5 กล่องนี้จะเก็บไว้ให้
// ============================================================================

use DB;
// ============================================================================
// บรรทัดนี้: ขอยืม "กุญแจห้องเก็บของ" มาใช้
// DB ย่อมาจาก Database = ฐานข้อมูล
// ใช้สำหรับ ดึงข้อมูล/เพิ่ม/แก้/ลบ จากตารางในฐานข้อมูล
// ============================================================================

class GoalsController extends Controller
// ============================================================================
// บรรทัดนี้: สร้าง "พนักงาน" ชื่อ GoalsController
// extends Controller = พนักงานคนนี้มีความสามารถพื้นฐานของ Controller
// พนักงานคนนี้รับผิดชอบเรื่อง "ประตู" (Goals) ทั้งหมด
// ============================================================================
{
    // ========================================================================
    // METHOD: index() - แสดงรายการประตูทั้งหมด
    // เมื่อไหร่ถูกเรียก: เมื่อคนเปิด URL /goals
    // หน้าที่: ไปดึงข้อมูลทั้งหมดมาแสดง
    // ========================================================================
    public function index()
    // public = ใครก็เรียกใช้ได้
    // function = นี่คือฟังก์ชัน (ก้อนคำสั่งที่ทำงานบางอย่าง)
    // index() = ชื่อฟังก์ชัน (หน้าแรก)
    {
        $goals = DB::table('Goals')->get();
        // ------------------------------------------------------------------
        // $goals = ตัวแปร (กล่องเก็บของ) ชื่อ goals
        // DB::table('Goals') = เปิดตู้ข้อมูลชื่อ Goals
        // ->get() = หยิบข้อมูลทั้งหมดมา (SELECT * FROM Goals)
        // รวมกัน: เอาข้อมูลทุกแถวจากตาราง Goals มาใส่กล่อง $goals
        // ------------------------------------------------------------------

        return view('goals.index', compact('goals'));
        // ------------------------------------------------------------------
        // return = ส่งกลับ
        // view('goals.index') = เปิดไฟล์ resources/views/goals/index.blade.php
        // compact('goals') = ห่อกล่อง $goals ส่งไปให้หน้าเว็บใช้
        //                    (สร้าง array ['goals' => $goals])
        // รวมกัน: เปิดหน้า index พร้อมส่งข้อมูล $goals ไปด้วย
        // ------------------------------------------------------------------
    }

    // ========================================================================
    // METHOD: create() - แสดงหน้ากรอกข้อมูลใหม่
    // เมื่อไหร่ถูกเรียก: เมื่อคนกดปุ่ม "เพิ่มข้อมูล" (URL: /goals/create)
    // หน้าที่: เตรียมตัวเลือกแมทช์และนักเตะ แล้วเปิดหน้าฟอร์ม
    // ========================================================================
    public function create()
    {
        $matches = DB::table('Matches')->get();
        // ------------------------------------------------------------------
        // เปิดตู้ Matches แล้วหยิบข้อมูลแมทช์ทั้งหมดมา
        // ทำไมต้องหยิบมา? เพราะต้องให้คนเลือกว่ายิงประตูในแมทช์ไหน
        // ข้อมูลนี้จะไปแสดงใน dropdown <select>
        // ------------------------------------------------------------------

        $players = DB::table('Players')->get();
        // ------------------------------------------------------------------
        // เปิดตู้ Players แล้วหยิบข้อมูลนักเตะทั้งหมดมา
        // ทำไมต้องหยิบมา? เพราะต้องให้คนเลือกว่านักเตะคนไหนยิง
        // ข้อมูลนี้จะไปแสดงใน dropdown <select>
        // ------------------------------------------------------------------

        return view('goals.create', compact('matches', 'players'));
        // ------------------------------------------------------------------
        // เปิดหน้า create.blade.php
        // พร้อมส่งกล่อง 2 กล่องไปด้วย:
        //   1. $matches = รายการแมทช์ทั้งหมด
        //   2. $players = รายชื่อนักเตะทั้งหมด
        // ------------------------------------------------------------------
    }

    // ========================================================================
    // METHOD: store() - บันทึกข้อมูลใหม่
    // เมื่อไหร่ถูกเรียก: เมื่อคนกดปุ่ม "บันทึก" ในหน้า create
    // หน้าที่: รับข้อมูลจากฟอร์ม แล้วเอาไปเก็บในฐานข้อมูล
    // ========================================================================
    public function store(Request $request)
    // ------------------------------------------------------------------
    // Request $request = รับกล่องพัสดุที่มีข้อมูลจากฟอร์ม
    // กล่องนี้เก็บทุกอย่างที่คนกรอก เช่น:
    //   $request->goal_id = ค่าในช่อง goal_id
    //   $request->match_id = ค่าในช่อง match_id
    // ------------------------------------------------------------------
    {
        $request->validate([
            'goal_id' => 'required',      // ช่อง goal_id ต้องกรอก ห้ามว่าง
            'match_id' => 'required',     // ช่อง match_id ต้องกรอก ห้ามว่าง
            'player_id' => 'required',    // ช่อง player_id ต้องกรอก ห้ามว่าง
            'goal_time' => 'required',    // ช่อง goal_time ต้องกรอก ห้ามว่าง
            'is_penalty' => 'required',   // ช่อง is_penalty ต้องกรอก ห้ามว่าง
        ]);
        // ------------------------------------------------------------------
        // validate = ตรวจสอบความถูกต้อง
        // 'required' = ต้องกรอก ถ้าไม่กรอกจะส่งกลับหน้าฟอร์มพร้อมแจ้ง error
        // เช็คทุกช่องว่ากรอกครบไหม
        // ------------------------------------------------------------------

        try {
        // ------------------------------------------------------------------
        // try = "ลองทำ" (เผื่อมีปัญหาจะได้จับ error ได้)
        // ------------------------------------------------------------------

            DB::table('Goals')->insert([
                'goal_id' => $request->goal_id,
                // ----------------------------------------------------------
                // เอาค่าจากช่อง goal_id ที่คนกรอก ไปใส่คอลัมน์ goal_id
                // $request->goal_id = ค่าที่ส่งมาจาก <input name="goal_id">
                // ----------------------------------------------------------
                'match_id' => $request->match_id,
                // เอาค่าจากช่อง match_id ไปใส่คอลัมน์ match_id
                'player_id' => $request->player_id,
                // เอาค่าจากช่อง player_id ไปใส่คอลัมน์ player_id
                'goal_time' => $request->goal_time,
                // เอาค่าจากช่อง goal_time ไปใส่คอลัมน์ goal_time
                'is_penalty' => $request->is_penalty,
                // เอาค่าจากช่อง is_penalty ไปใส่คอลัมน์ is_penalty
            ]);
            // ------------------------------------------------------------------
            // DB::table('Goals') = เปิดตู้ Goals
            // ->insert([...]) = เพิ่มข้อมูลใหม่เข้าไป (INSERT INTO Goals...)
            // ------------------------------------------------------------------

            return redirect()->route('goals.index')->with('success', 'สร้างสำเร็จ');
            // ------------------------------------------------------------------
            // redirect() = เปลี่ยนหน้า (พาคนไปหน้าอื่น)
            // ->route('goals.index') = ไปที่หน้า /goals (หน้ารายการ)
            // ->with('success', 'สร้างสำเร็จ') = ส่งข้อความไปแสดงเป็นกล่องสีเขียว
            // ------------------------------------------------------------------

        } catch (\Exception $e) {
            // ------------------------------------------------------------------
            // catch = "ถ้ามีปัญหา ให้ทำแบบนี้แทน"
            // เช่น ถ้า goal_id ซ้ำ จะเข้ามาที่นี่
            // ------------------------------------------------------------------

            return redirect()->route('goals.index')->with('failed', 'สร้างล้มเหลว');
            // กลับหน้ารายการ พร้อมข้อความ "สร้างล้มเหลว" สีแดง
        }
    }

    // ========================================================================
    // METHOD: edit($id) - แสดงหน้าแก้ไขข้อมูล
    // เมื่อไหร่ถูกเรียก: เมื่อคนกดปุ่ม "แก้ไข" (URL: /goals/5/edit)
    // หน้าที่: ดึงข้อมูลเดิมมาแสดงในฟอร์ม ให้คนแก้
    // ========================================================================
    public function edit(string $id)
    // ------------------------------------------------------------------
    // string $id = รับตัวเลข id มาจาก URL
    // เช่น ถ้า URL เป็น /goals/5/edit จะได้ $id = "5"
    // ------------------------------------------------------------------
    {
        $goals = DB::table('Goals')->where('goal_id', $id)->get();
        // ------------------------------------------------------------------
        // DB::table('Goals') = เปิดตู้ Goals
        // ->where('goal_id', $id) = หาแถวที่ goal_id ตรงกับ $id
        //                          (WHERE goal_id = 5)
        // ->get() = หยิบมา
        // รวมกัน: หาข้อมูลแถวที่ต้องการแก้ไขมาใส่กล่อง $goals
        // ------------------------------------------------------------------

        $matches = DB::table('Matches')->get();
        // ดึงแมทช์ทั้งหมดมาให้เลือกใน dropdown

        $players = DB::table('Players')->get();
        // ดึงนักเตะทั้งหมดมาให้เลือกใน dropdown

        return view('goals.edit', compact('goals', 'matches', 'players'));
        // ------------------------------------------------------------------
        // เปิดหน้า edit.blade.php
        // พร้อมส่ง 3 กล่องไป:
        //   1. $goals = ข้อมูลเดิมที่จะแก้
        //   2. $matches = รายการแมทช์ (ให้เลือกเปลี่ยน)
        //   3. $players = รายชื่อนักเตะ (ให้เลือกเปลี่ยน)
        // ------------------------------------------------------------------
    }

    // ========================================================================
    // METHOD: update($request, $id) - บันทึกการแก้ไข
    // เมื่อไหร่ถูกเรียก: เมื่อคนกดปุ่ม "บันทึก" ในหน้า edit
    // หน้าที่: เอาข้อมูลใหม่ไปเขียนทับข้อมูลเดิม
    // ========================================================================
    public function update(Request $request, string $id)
    // ------------------------------------------------------------------
    // Request $request = กล่องพัสดุใส่ข้อมูลที่คนแก้
    // string $id = รหัสของแถวที่จะแก้ (มาจาก URL)
    // ------------------------------------------------------------------
    {
        $request->validate([
            'match_id' => 'required',     // ต้องเลือกแมทช์
            'player_id' => 'required',    // ต้องเลือกนักเตะ
            'goal_time' => 'required',    // ต้องกรอกเวลา
            'is_penalty' => 'required',   // ต้องกรอกลูกโทษ
        ]);
        // ------------------------------------------------------------------
        // ตรวจสอบว่ากรอกครบไหม
        // สังเกต: ไม่มี goal_id เพราะ goal_id แก้ไม่ได้ (เป็น Primary Key)
        // ------------------------------------------------------------------

        try {
            DB::table('Goals')->where('goal_id', $id)->update([
                'match_id' => $request->match_id,
                // เปลี่ยนค่า match_id เป็นค่าใหม่ที่คนเลือก
                'player_id' => $request->player_id,
                // เปลี่ยนค่า player_id เป็นค่าใหม่ที่คนเลือก
                'goal_time' => $request->goal_time,
                // เปลี่ยนค่า goal_time เป็นค่าใหม่ที่คนกรอก
                'is_penalty' => $request->is_penalty,
                // เปลี่ยนค่า is_penalty เป็นค่าใหม่ที่คนกรอก
            ]);
            // ------------------------------------------------------------------
            // DB::table('Goals') = เปิดตู้ Goals
            // ->where('goal_id', $id) = หาแถวที่ goal_id = $id
            // ->update([...]) = แก้ไขข้อมูลในแถวนั้น
            //                   (UPDATE Goals SET ... WHERE goal_id = 5)
            // ------------------------------------------------------------------

            return redirect()->route('goals.index')->with('success', 'แก้ไขสำเร็จ');
            // กลับหน้ารายการ พร้อมข้อความ "แก้ไขสำเร็จ" สีเขียว

        } catch (\Exception $e) {
            return redirect()->route('goals.index')->with('failed', 'แก้ไขล้มเหลว');
            // ถ้ามีปัญหา กลับหน้ารายการ พร้อมข้อความ "แก้ไขล้มเหลว" สีแดง
        }
    }

    // ========================================================================
    // METHOD: destroy($id) - ลบข้อมูล
    // เมื่อไหร่ถูกเรียก: เมื่อคนกดปุ่ม "ลบ"
    // หน้าที่: ลบแถวนั้นออกจากฐานข้อมูล
    // ========================================================================
    public function destroy(string $id)
    // ------------------------------------------------------------------
    // string $id = รหัสของแถวที่จะลบ (มาจาก URL)
    // ------------------------------------------------------------------
    {
        try {
            DB::table('Goals')->where('goal_id', $id)->delete();
            // ------------------------------------------------------------------
            // DB::table('Goals') = เปิดตู้ Goals
            // ->where('goal_id', $id) = หาแถวที่ goal_id = $id
            // ->delete() = ลบแถวนั้นทิ้ง (DELETE FROM Goals WHERE goal_id = 5)
            // ------------------------------------------------------------------

            return redirect()->route('goals.index')->with('success', 'ลบสำเร็จ');
            // กลับหน้ารายการ พร้อมข้อความ "ลบสำเร็จ" สีเขียว

        } catch (\Exception $e) {
            return redirect()->route('goals.index')->with('failed', 'ลบล้มเหลว');
            // ถ้ามีปัญหา (เช่น มีตารางอื่นอ้างอิงอยู่)
            // กลับหน้ารายการ พร้อมข้อความ "ลบล้มเหลว" สีแดง
        }
    }
}
```

---

## 📄 3. Views (หน้าเว็บที่คนเห็น)

> **🎯 อ่านตรงนี้ก่อน!** Views คือ "หน้าเว็บ" ที่คนเห็น เหมือนป้ายหน้าร้าน!

---

### 3.1 layout.blade.php - โครงหน้าเว็บ

**มันคืออะไร:** เหมือน "กรอบรูป" ที่ทุกหน้าใช้ร่วมกัน (เมนู, ส่วนหัว) แค่เปลี่ยนเนื้อหาข้างใน

```html
<!DOCTYPE html>
<html>
    <head>
        <title>@yield('title')</title>
        <link href="bootstrap.css" rel="stylesheet" />
    </head>
    <body>
        <nav>
            <a href="/goals">ตารางประตู</a>
            <a href="/players">นักกีฬา</a>
        </nav>
        <div class="container">@yield('content')</div>
    </body>
</html>
```

**🔍 อธิบายส่วนสำคัญ:**

| โค้ด                | แปลเป็นภาษาคน                          |
| ------------------- | -------------------------------------- |
| `@yield('title')`   | ช่องว่างรอใส่ชื่อหน้า (หน้าลูกจะส่งมา) |
| `@yield('content')` | ช่องว่างรอใส่เนื้อหา (หน้าลูกจะส่งมา)  |

**🏠 เปรียบเทียบกับชีวิตจริง:**

```
layout.blade.php เหมือน "โครงบ้าน":

┌──────────────────────────────┐
│  หลังคา (เมนูด้านบน - nav)   │  ← ทุกหน้าเหมือนกัน
├──────────────────────────────┤
│                              │
│  @yield('content')           │  ← ช่องว่างรอใส่เนื้อหา
│  (เหมือนห้องว่างรอตกแต่ง)     │     แต่ละหน้าตกแต่งต่างกัน
│                              │
└──────────────────────────────┘
```

---

### 3.2 index.blade.php - หน้าดูรายการทั้งหมด

```blade
@extends('layout')
@section('title', 'ตารางประตู')
@section('content')
    <!-- เนื้อหาหน้านี้ -->
@endsection
```

**🔍 อธิบายทีละบรรทัด:**

| โค้ด                              | แปลเป็นภาษาคน                                    |
| --------------------------------- | ------------------------------------------------ |
| `@extends('layout')`              | หน้านี้ใช้กรอบจาก layout.blade.php               |
| `@section('title', 'ตารางประตู')` | ส่งชื่อหน้า "ตารางประตู" ไปใส่ใน @yield('title') |
| `@section('content')`             | เริ่มเนื้อหาที่จะไปใส่ใน @yield('content')       |
| `@endsection`                     | จบเนื้อหา                                        |

**🏠 เปรียบเทียบกับชีวิตจริง:**

```
เหมือนต่อจิ๊กซอว์:

layout.blade.php (กรอบ)     +     index.blade.php (เนื้อหา)
┌─────────────────┐              ┌─────────────────┐
│ @yield('title') │    ←───────  │ 'ตารางประตู'    │
├─────────────────┤              └─────────────────┘
│                 │              ┌─────────────────┐
│ @yield('content')│  ←───────  │ ตารางข้อมูล...   │
│                 │              └─────────────────┘
└─────────────────┘
```

---

#### ส่วนปุ่มเพิ่มข้อมูล

```html
<a href="{{ route('goals.create') }}">
    <button class="btn btn-success">เพิ่มข้อมูล</button>
</a>
```

| โค้ด                          | แปลเป็นภาษาคน                  |
| ----------------------------- | ------------------------------ |
| `{{ route('goals.create') }}` | สร้าง URL เป็น `/goals/create` |
| `btn btn-success`             | ปุ่มสีเขียว (จาก Bootstrap)    |

**กดแล้วเกิดอะไร?** → ไปหน้า `/goals/create` → Controller `create()` → เปิดหน้า `create.blade.php`

---

#### ส่วนแสดงข้อความสำเร็จ

```blade
@if (session('success'))
    <div class="alert alert-success">{{ session('success') }}</div>
@endif
```

| โค้ด                       | แปลเป็นภาษาคน                 |
| -------------------------- | ----------------------------- |
| `@if (session('success'))` | ถ้ามีข้อความ success ที่ส่งมา |
| `{{ session('success') }}` | แสดงข้อความนั้นออกมา          |
| `alert-success`            | กล่องข้อความสีเขียว           |

**มาจากไหน?** → มาจาก Controller ที่ทำ `->with('success', 'สร้างสำเร็จ')`

---

#### ส่วนวนลูปแสดงข้อมูล

```blade
@foreach($goals as $go)
<tr>
    <td>{{ $go->goal_id }}</td>
    <td>{{ $go->match_id }}</td>
    <td>{{ $go->player_id }}</td>
    <td>{{ $go->goal_time }}</td>
    <td>{{ $go->is_penalty }}</td>
</tr>
@endforeach
```

**🔍 อธิบายทีละบรรทัด:**

| โค้ด                      | แปลเป็นภาษาคน                       |
| ------------------------- | ----------------------------------- |
| `@foreach($goals as $go)` | วนลูป: ทุกแถวใน $goals เรียกว่า $go |
| `{{ $go->goal_id }}`      | เอาค่า goal_id ของแถวนี้มาแสดง      |
| `{{ $go->match_id }}`     | เอาค่า match_id ของแถวนี้มาแสดง     |
| `@endforeach`             | จบการวนลูป                          |

**🏠 เปรียบเทียบกับชีวิตจริง:**

```
$goals = รายชื่อนักเรียนทั้งห้อง (หลายคน)
$go = นักเรียน 1 คน (ทีละคน)

เหมือนเช็คชื่อ:
"เรียกชื่อทีละคน แล้วเขียนลงตาราง"

@foreach($goals as $go)    ←─ "วนดูนักเรียนทีละคน"
    $go->goal_id           ←─ "เขียนชื่อคนนี้"
@endforeach                ←─ "จบแล้ว คนสุดท้ายแล้ว"
```

**❓ `$go->goal_id` คืออะไร?**

```
$go เป็น Object (วัตถุ) ที่มีข้อมูลหลายช่อง:
$go = {
    goal_id: 1,
    match_id: 5,
    player_id: 10,
    goal_time: 45,
    is_penalty: 0
}

$go->goal_id = เอาค่า goal_id ออกมา = 1
$go->match_id = เอาค่า match_id ออกมา = 5
```

---

#### ส่วนปุ่มแก้ไขและลบ

```blade
<!-- ปุ่มแก้ไข -->
<a href="{{ route('goals.edit', $go->goal_id) }}">
    <button class="btn btn-warning">แก้ไข</button>
</a>

<!-- ปุ่มลบ -->
<form action="{{ route('goals.destroy', $go->goal_id) }}" method="POST">
    @csrf
    @method('DELETE')
    <button class="btn btn-danger">ลบ</button>
</form>
```

**🔍 อธิบายทีละบรรทัด:**

| โค้ด                                   | แปลเป็นภาษาคน                                    |
| -------------------------------------- | ------------------------------------------------ |
| `route('goals.edit', $go->goal_id)`    | สร้าง URL เป็น `/goals/5/edit` (ถ้า goal_id = 5) |
| `route('goals.destroy', $go->goal_id)` | สร้าง URL เป็น `/goals/5` สำหรับลบ               |
| `@csrf`                                | รหัสความปลอดภัย (ต้องมีทุกฟอร์ม!)                |
| `@method('DELETE')`                    | บอกว่านี่คือการลบ ไม่ใช่การส่งข้อมูล             |

**❓ ทำไมปุ่มลบต้องใช้ `<form>`?**

```
เพราะ HTML รองรับแค่ 2 วิธี: GET กับ POST
แต่การลบใน Laravel ต้องใช้ DELETE
เลยต้องใช้ฟอร์ม + @method('DELETE') เพื่อ "หลอก" ว่าเป็น DELETE

ปกติ: <form method="POST">  →  ส่งเป็น POST
เพิ่ม: @method('DELETE')    →  Laravel รู้ว่าจริงๆ คือ DELETE
```

---

### 3.3 create.blade.php - หน้ากรอกข้อมูลใหม่

```blade
@extends('layout')
@section('content')
    <form action="{{ route('goals.store') }}" method="POST">
        @csrf

        <input type="text" name="goal_id" placeholder="รหัสประตู">

        <select name="match_id">
            @foreach ($matches as $match)
                <option value="{{ $match->match_id }}">
                    {{ $match->match_id }} - ทีม {{ $match->team1_id }} vs {{ $match->team2_id }}
                </option>
            @endforeach
        </select>

        <select name="player_id">
            @foreach ($players as $player)
                <option value="{{ $player->player_id }}">
                    {{ $player->first_name }} {{ $player->last_name }}
                </option>
            @endforeach
        </select>

        <input type="text" name="goal_time" placeholder="นาทีที่ยิง">
        <input type="text" name="is_penalty" placeholder="จุดโทษไหม (0=ไม่ใช่, 1=ใช่)">

        <a href="{{ route('goals.index') }}" class="btn btn-danger">ยกเลิก</a>
        <button type="submit" class="btn btn-primary">บันทึก</button>
    </form>
@endsection
```

**🔍 อธิบายส่วนสำคัญ:**

| โค้ด                                  | แปลเป็นภาษาคน                                         |
| ------------------------------------- | ----------------------------------------------------- |
| `action="{{ route('goals.store') }}"` | กดบันทึกแล้วส่งไป `/goals` (store method)             |
| `method="POST"`                       | ส่งข้อมูลแบบซ่อน (ไม่โชว์บน URL)                      |
| `@csrf`                               | รหัสความปลอดภัย (ต้องมี!)                             |
| `name="goal_id"`                      | ชื่อช่องนี้ ส่งไป Controller เป็น `$request->goal_id` |

**🏠 เปรียบเทียบ name กับ $request:**

```
หน้าเว็บ (View):
<input name="goal_id" value="1">
<input name="player_id" value="10">
         ↓
         ↓  กดปุ่มบันทึก
         ↓
Controller:
$request->goal_id   = 1
$request->player_id = 10

เหมือนกรอกใบสมัคร:
- ช่อง "ชื่อ" = name
- สิ่งที่เขียน = value
- Controller รับไปเก็บ
```

---

#### ส่วน Dropdown (เลือกจากรายการ)

```blade
<select name="match_id">
    @foreach ($matches as $match)
        <option value="{{ $match->match_id }}">
            {{ $match->match_id }} - ทีม {{ $match->team1_id }} vs {{ $match->team2_id }}
        </option>
    @endforeach
</select>
```

**🔍 อธิบาย:**

| โค้ด                             | แปลเป็นภาษาคน                   |
| -------------------------------- | ------------------------------- |
| `<select name="match_id">`       | Dropdown ที่ส่งค่าชื่อ match_id |
| `@foreach ($matches as $match)`  | วนสร้าง option ทีละแมทช์        |
| `value="{{ $match->match_id }}"` | ค่าที่จะส่งไป Controller (รหัส) |
| ข้อความใน `<option>`             | ที่คนเห็นบนหน้าจอ               |

**🏠 เปรียบเทียบกับชีวิตจริง:**

```
Dropdown = เมนูอาหารตามสั่ง

<option value="1">ไทย vs ญี่ปุ่น</option>
<option value="2">ไทย vs เกาหลี</option>
              ↑              ↑
        ค่าที่ส่ง      ที่คนเห็น

คนเลือก "ไทย vs ญี่ปุ่น" → Controller ได้ค่า 1
```

---

### 3.4 edit.blade.php - หน้าแก้ไข

```blade
@extends('layout')
@section('content')
    @foreach($goals as $go)
    @endforeach

    <form action="{{ route('goals.update', $go->goal_id) }}" method="POST">
        @csrf
        @method('PUT')

        <input type="text" name="goal_id" value="{{ $go->goal_id }}" readonly>
        <input type="text" name="goal_time" value="{{ $go->goal_time }}">
        <input type="text" name="is_penalty" value="{{ $go->is_penalty }}">

        <select name="match_id">
            @foreach ($matches as $match)
                <option value="{{ $match->match_id }}">{{ $match->match_id }}</option>
            @endforeach
        </select>

        <button type="submit" class="btn btn-primary">บันทึก</button>
    </form>
@endsection
```

**🔍 อธิบายส่วนสำคัญ:**

| โค้ด                         | แปลเป็นภาษาคน                                       |
| ---------------------------- | --------------------------------------------------- |
| `@method('PUT')`             | บอกว่านี่คือการแก้ไข (ไม่ใช่สร้างใหม่)              |
| `value="{{ $go->goal_id }}"` | ใส่ค่าเดิมไว้ในช่อง                                 |
| `readonly`                   | อ่านได้อย่างเดียว แก้ไม่ได้ (เพราะเป็น Primary Key) |

**❓ ทำไมต้องใช้ `@method('PUT')`?**

```
เหมือนปุ่มลบ: HTML รองรับแค่ GET กับ POST
แต่การแก้ไขใน Laravel ต้องใช้ PUT
เลยต้องใช้ @method('PUT') เพื่อ "หลอก" ว่าเป็น PUT

ปกติ: <form method="POST">  →  ส่งเป็น POST (สร้างใหม่)
เพิ่ม: @method('PUT')       →  Laravel รู้ว่าจริงๆ คือ PUT (แก้ไข)
```

**❓ `@foreach($goals as $go)` ตรงต้น ทำอะไร?**

```
Controller ส่ง $goals มาเป็น Collection (หลายแถว)
แต่จริงๆ มีแค่ 1 แถว (เพราะหาด้วย where แล้ว)

@foreach($goals as $go)
@endforeach

= ดึงข้อมูลแถวนั้นมาใส่ในตัวแปร $go ให้ใช้ด้านล่างได้
```

---

## 🔄 4. สรุปง่ายๆ ว่าระบบทำงานยังไง

```
┌─────────────────────────────────────────────────────────────────┐
│                     คนเปิดเว็บ /goals                           │
│                          ↓                                      │
│   web.php: "อ๋อ /goals นี่นะ ไป GoalsController นะ"              │
│                          ↓                                      │
│   Controller: "โอเค ฉันจะไปดึงข้อมูลจากฐานข้อมูลมาให้"            │
│                          ↓                                      │
│   Controller: "เอาข้อมูลไปแสดงที่หน้า index.blade.php นะ"        │
│                          ↓                                      │
│   View: แสดงตารางให้คนดู                                         │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📌 5. คำสั่งสำคัญ (อ่านตรงนี้ก่อนสอบ!)

| คำสั่ง                                                   | มันทำอะไร                                   |
| -------------------------------------------------------- | ------------------------------------------- |
| `Route::resource('goals', ...)`                          | สร้าง 7 เส้นทางให้อัตโนมัติ ไม่ต้องพิมพ์เอง |
| `DB::table('Goals')->get()`                              | ดึงข้อมูลทั้งหมดจากตาราง Goals              |
| `DB::table('Goals')->insert([...])`                      | เพิ่มข้อมูลใหม่เข้าไป                       |
| `DB::table('Goals')->where('goal_id', 5)->update([...])` | แก้ไขข้อมูลที่ ID เป็น 5                    |
| `DB::table('Goals')->where('goal_id', 5)->delete()`      | ลบข้อมูลที่ ID เป็น 5                       |
| `compact('goals')`                                       | ห่อตัวแปร $goals ส่งไปให้ View ใช้          |
| `return view('goals.index', ...)`                        | ไปแสดงหน้า index.blade.php                  |
| `redirect()->route('goals.index')`                       | กลับไปหน้าแรก                               |
| `->with('success', 'สำเร็จ')`                            | ส่งข้อความไปแสดงหลังกลับหน้าแรก             |
| `$request->goal_id`                                      | รับค่าจากช่องที่ name="goal_id"             |
| `@extends('layout')`                                     | ใช้กรอบหน้าเว็บจาก layout                   |
| `@section('content')`                                    | เริ่มเนื้อหา                                |
| `@yield('content')`                                      | ช่องว่างรอใส่เนื้อหา                        |
| `@foreach($goals as $go)`                                | วนลูปดูข้อมูลทีละแถว                        |
| `{{ $go->goal_id }}`                                     | แสดงค่า goal_id                             |
| `{{ route('goals.edit', 5) }}`                           | สร้าง URL เป็น /goals/5/edit                |
| `@csrf`                                                  | รหัสความปลอดภัย ต้องมีทุกฟอร์ม              |
| `@method('PUT')`                                         | บอกว่าเป็นการแก้ไข                          |
| `@method('DELETE')`                                      | บอกว่าเป็นการลบ                             |

---

## ❓ ถ้าอาจารย์ถาม

**ถ: Route::resource ทำอะไร?**

> สร้าง 7 เส้นทาง CRUD อัตโนมัติ (ดู, เพิ่ม, แก้, ลบ)

**ถ: DB::table()->get() ทำอะไร?**

> ดึงข้อมูลทั้งหมดจากตาราง

**ถ: compact() ทำอะไร?**

> ห่อตัวแปรส่งไปให้ View ใช้

**ถ: @csrf ทำอะไร?**

> สร้างรหัสความปลอดภัยป้องกันการปลอมแปลง ต้องมีทุกฟอร์ม

**ถ: @extends('layout') ทำอะไร?**

> บอกว่าหน้านี้ใช้กรอบจาก layout.blade.php

**ถ: @yield กับ @section ต่างกันยังไง?**

> @yield = ช่องว่างรอใส่ของ (อยู่ใน layout)
> @section = ของที่จะใส่ลงไป (อยู่ในหน้าลูก)

**ถ: ทำไมต้องใช้ @method('DELETE')?**

> เพราะ HTML Form รองรับแค่ GET กับ POST ต้องใช้ @method บอก Laravel ว่าจริงๆ เป็น DELETE
